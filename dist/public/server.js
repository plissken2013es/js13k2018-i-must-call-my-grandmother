var users={},dummy=[{s:25,n:"Zane"},{s:120,n:"Drew"},{s:150,n:"Faris"},{s:65,n:"Dante"},{s:200,n:"Lucy"},{s:95,n:"Bobby"}];function removeUser(a){users[a]&&delete users[a]}function prettyTime(a){var b=a/60|0;a-=60*b;return(10>b?"0"+b:b)+":"+(10>a?"0"+a:a)}
module.exports={io:function(a){0>=storage.size()&&storage.set("scores",dummy);a.on("clear",function(){storage.clear()});a.on("disconnect",function(){removeUser(a.id)});a.on("login",function(b){users[a.id]={n:b,s:0};a.broadcast.emit("new",b)});a.on("scores",function(){storage.get("scores",dummy).then(function(b){a.emit("scores",b)})});a.on("beat",function(b){a.broadcast.emit("beat",b);storage.get("scores",dummy).then(function(a){a.push(b);a.slice(0,149);storage.set("scores",a).then(function(b){io.emit("scores",
a)})})})},stat:function(a,b){storage.get("scores",dummy).then(function(a){a=a.sort(function(a,b){return a.s<b.s?1:a.s>b.s?-1:0});var c="<h1>High scores</h1>";a.forEach(function(a,b){c+="<p>"+(b+1)+". "+a.n+" - "+prettyTime(a.s)+"</p>"});b.send(c)})}};